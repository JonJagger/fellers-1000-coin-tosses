<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Feller's coin tosses</title>    
    <script src="jquery-1.8.3.js"           type="text/javascript"></script>
    <script src="jquery.flot.js"            type="text/javascript" ></script>
    <script src="jquery.flot.axislabels.js" type="text/javascript" ></script>

    <script type="text/javascript">

        // Frequencies of cumulative total after N coin
        // flips where N=10,30,100,1000
        var freq_10   = [ [ ], [ ] ]  // -ve, +ve
        var freq_30   = [ [ ], [ ] ]  // -ve, +ve
        var freq_100  = [ [ ], [ ] ]; // -ve, +ve
        var freq_1000 = [ [ ], [ ] ]; // -ve, +ve
        // Work-around: plot requires an array of data-points
        // and javascript cannot use negative array indexes
        // so I use one array for -ve x-values and
        // one array for +ve x-values
        var NEG = 0;
        var POS = 1;
        
        $(document).ready(function () {
            var n = 0;
            var fid = setInterval(
                function() {
                    if (n++ === 5000) {
                        clearInterval(fid);
                    } else {
                        var walk = doOneWalk();
                        if (n % 100 === 0) {
                            $.plot($("#fellers-walk"),
                                   [ { label: "Walk-"+n, data: walk } ],
                                   walkPlotOptions(walk));
                                                        
                            $.plot($("#fellers-prob"),
                                   getProbabilities(n),
                                   probabilityPlotOptions());
                        }                                    
                    }                    
                },
                0);
        });
        
        function doOneWalk() {
            var walk = [ ];
            var total = 0;
            for (var step = 0; step < 1000; step++) {
                var rnd = Math.random();
                var toss = (rnd < 0.5) ? "head" : "tail";
                if (toss === "head") {
                    total += 1;
                } else {
                    total -= 1;
                }
                walk.push([step,total]);
                
                if (step === 10) {
                    recordTotal(freq_10, total);
                }
                if (step === 30) {
                    recordTotal(freq_30, total);
                }
                if (step === 100) {
                    recordTotal(freq_100, total);
                }
            }
            recordTotal(freq_1000, total);
            return walk;
        }       

        function recordTotal(array, total) {
            var NP = (total < 0) ? NEG : POS;
            var index = Math.abs(total);
            if (array[NP][index] === undefined) {
                array[NP][index] = [total,0];
            }
            array[NP][index][1]++;            
        }

        function getProbabilities(n) {
            return [ 
                { label: "after 10 flips",   data: calcProbs(n,freq_10)   },
                { label: "after 30 flips",   data: calcProbs(n,freq_30)   },
                { label: "after 100 flips",  data: calcProbs(n,freq_100)  },
                { label: "after 1000 flips", data: calcProbs(n,freq_1000) }
            ];
        }
        
        function calcProbs(n, freq) {
            var probs = [ [ ], [ ] ];
            var neg = freq[NEG];
            for (var at in neg) {
                if (neg[at] !== undefined) {
                    probs[NEG][at] = [ neg[at][0], neg[at][1] / n ];
                }
            }
            var pos = freq[POS];
            for (var at in pos) {
                if (pos[at] !== undefined) {
                    probs[POS][at] = [ pos[at][0], pos[at][1] / n ];
                }
            }
            var all = probs[NEG].reverse().concat(probs[POS]);
            var result = [ ];
            for (var at = 0; at < all.length; at++) {
                if (all[at] !== undefined) {
                    result.push(all[at]);
                }
            }            
            return result;
        }
    
        function probabilityPlotOptions() {
            return {
                legend: {
                    position: "nw"
                },                                
                xaxis: {
                    axisLabel: "Y:probability, X:total",                                        
                    position: "bottom",
                },
                series: {
                    lines: {
                        show: true
                    },
                    points: {
                        show: false,
                    }
                }
            };                        
        }
        
        function walkPlotOptions(walk) {
            return {
                legend: {
                    position: "nw"
                },                                
                xaxis: {
                    axisLabel: "Y:total, X:flip",                                        
                    position: "bottom",
                    min: 0,
                    max: walk.length
                },
                yaxis: {
                    tickDecimals: 0,
                    min: -50,
                    max: 50                    
                },
                series: {
                    lines: {
                        show: true
                    },
                    points: {
                        show: false,
                    }
                }
            };            
        }
    </script>
</head>
<body>          
    <style type="text/css">
    #fellers-walk { width: 1200px; height: 300px; }
    #fellers-prob { width: 1200px; height: 300px; }
    </style>
    
    <table>
        <tr>
            <td><div id="fellers-walk"></div></td>
        </tr>
        <tr>
            <td><div id="fellers-prob"></div></td>
        </tr>
    </table>
</body>
</html>
